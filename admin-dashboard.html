<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hair Design Review - ç®¡ç†ç”»é¢</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .admin-header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .admin-header p {
            color: #666;
            font-size: 1.1em;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f9f9f9;
        }

        .section h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .form-group input[type="file"],
        .form-group input[type="password"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .info-box p {
            margin: 5px 0;
            color: #0c5460;
        }

        .data-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .status-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .status-card .label {
            color: #666;
            margin-top: 5px;
        }

        .file-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ¨ Hair Design Review ç®¡ç†ç”»é¢</h1>
            <p>CSVã€ç”»åƒã€è¨­å®šã‚’ç®¡ç†ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™</p>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <section class="section">
            <h2><span class="section-icon">ğŸ“Š</span>ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çŠ¶æ³</h2>
            <div class="data-status" id="dataStatus">
                <div class="status-card">
                    <div class="number" id="stylistCount">0</div>
                    <div class="label">ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ</div>
                </div>
                <div class="status-card">
                    <div class="number" id="reviewCount">0</div>
                    <div class="label">ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
                </div>
                <div class="status-card">
                    <div class="number" id="imageCount">0</div>
                    <div class="label">ç”»åƒ</div>
                </div>
            </div>
        </section>

        <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <section class="section">
            <h2><span class="section-icon">ğŸ“„</span>CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>

            <div class="form-group">
                <label for="stylistsCsv">ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆCSVï¼ˆstylists.csvï¼‰</label>
                <input type="file" id="stylistsCsv" accept=".csv">
                <div class="file-info">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: å§“å,ã‚»ã‚¤ãƒ¡ã‚¤,å‹¤å‹™ã‚µãƒ­ãƒ³å,ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹,ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å,å¹´é½¢</div>
            </div>

            <div class="form-group">
                <label for="reviewsCsv">ãƒ¬ãƒ“ãƒ¥ãƒ¼CSVï¼ˆreviews.csvï¼‰</label>
                <input type="file" id="reviewsCsv" accept=".csv">
                <div class="file-info">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: å›ç­”è€…ç•ªå·,é¸æŠã—ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«,ã‚³ãƒ¡ãƒ³ãƒˆ,è·æ¥­,å¹´é½¢,æ€§åˆ¥,æ—¢å©šæœªå©š,å­ä¾›ã®æœ‰ç„¡,å¥³æ€§åƒ...</div>
            </div>

            <button class="btn btn-primary" onclick="uploadCSVs()">CSVã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            <div class="status-message" id="csvStatus"></div>
        </section>

        <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <section class="section">
            <h2><span class="section-icon">ğŸ–¼ï¸</span>ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>

            <div class="form-group">
                <label for="imagesZip">ç”»åƒZIPãƒ•ã‚¡ã‚¤ãƒ«</label>
                <input type="file" id="imagesZip" accept=".zip">
                <div class="file-info">hair_design_001.jpg ï½ hair_design_020.jpg ãªã©ã®ç”»åƒã‚’å«ã‚€ZIPãƒ•ã‚¡ã‚¤ãƒ«</div>
            </div>

            <button class="btn btn-primary" onclick="uploadImages()">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            <div class="status-message" id="imageStatus"></div>

            <div class="info-box">
                <p><strong>æ³¨æ„:</strong> ZIPãƒ•ã‚¡ã‚¤ãƒ«ã¯ JSZip ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦è§£å‡ã•ã‚Œã¾ã™ã€‚</p>
                <p>ç”»åƒã¯ Base64 å½¢å¼ã§ localStorage ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            </div>
        </section>

        <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š -->
        <section class="section">
            <h2><span class="section-icon">ğŸ”</span>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š</h2>

            <div class="form-group">
                <label for="ownerPassword">ã‚ªãƒ¼ãƒŠãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="ownerPassword" placeholder="ã‚ªãƒ¼ãƒŠãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            </div>

            <div class="form-group">
                <label for="secretPhrase">åˆè¨€è‘‰ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«å¿…è¦ï¼‰</label>
                <input type="text" id="secretPhrase" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”¨ã®åˆè¨€è‘‰">
            </div>

            <button class="btn btn-primary" onclick="savePasswords()">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜</button>
            <div class="status-message" id="passwordStatus"></div>
        </section>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ -->
        <section class="section">
            <h2><span class="section-icon">âš ï¸</span>ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</h2>
            <p style="color: #666; margin-bottom: 20px;">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚</p>

            <button class="btn btn-danger" onclick="resetAllData()">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            <div class="status-message" id="resetStatus"></div>
        </section>
    </div>

    <!-- JSZip ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- PapaParse ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ã‚’è¡¨ç¤º
        window.addEventListener('DOMContentLoaded', () => {
            updateDataStatus();
        });

        // ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ã®æ›´æ–°
        function updateDataStatus() {
            const stylists = JSON.parse(localStorage.getItem('stylistsData') || '[]');
            const reviews = JSON.parse(localStorage.getItem('reviewsData') || '[]');
            const images = JSON.parse(localStorage.getItem('imagesData') || '{}');

            document.getElementById('stylistCount').textContent = stylists.length;
            document.getElementById('reviewCount').textContent = reviews.length;
            document.getElementById('imageCount').textContent = Object.keys(images).length;
        }

        // CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadCSVs() {
            const stylistsFile = document.getElementById('stylistsCsv').files[0];
            const reviewsFile = document.getElementById('reviewsCsv').files[0];
            const statusEl = document.getElementById('csvStatus');

            if (!stylistsFile && !reviewsFile) {
                showStatus(statusEl, 'error', 'å°‘ãªãã¨ã‚‚1ã¤ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                if (stylistsFile) {
                    const stylistsText = await stylistsFile.text();
                    const parsed = Papa.parse(stylistsText, { header: true, skipEmptyLines: true });
                    localStorage.setItem('stylistsData', JSON.stringify(parsed.data));
                }

                if (reviewsFile) {
                    const reviewsText = await reviewsFile.text();
                    const parsed = Papa.parse(reviewsText, { header: true, skipEmptyLines: true });
                    localStorage.setItem('reviewsData', JSON.stringify(parsed.data));
                }

                showStatus(statusEl, 'success', 'CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸï¼');
                updateDataStatus();
            } catch (error) {
                showStatus(statusEl, 'error', 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadImages() {
            const zipFile = document.getElementById('imagesZip').files[0];
            const statusEl = document.getElementById('imageStatus');

            if (!zipFile) {
                showStatus(statusEl, 'error', 'ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const zip = new JSZip();
                const zipData = await zip.loadAsync(zipFile);
                const images = {};
                let imageCount = 0;

                for (const [filename, file] of Object.entries(zipData.files)) {
                    if (!file.dir && /\.(jpg|jpeg|png|gif)$/i.test(filename)) {
                        const blob = await file.async('blob');
                        const base64 = await blobToBase64(blob);
                        const cleanFilename = filename.split('/').pop(); // ãƒ•ã‚©ãƒ«ãƒ€åã‚’é™¤å»
                        images[cleanFilename] = base64;
                        imageCount++;
                    }
                }

                localStorage.setItem('imagesData', JSON.stringify(images));
                showStatus(statusEl, 'success', `${imageCount}æšã®ç”»åƒãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸï¼`);
                updateDataStatus();
            } catch (error) {
                showStatus(statusEl, 'error', 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // Blobã‚’ Base64 ã«å¤‰æ›
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
        function savePasswords() {
            const ownerPassword = document.getElementById('ownerPassword').value;
            const secretPhrase = document.getElementById('secretPhrase').value;
            const statusEl = document.getElementById('passwordStatus');

            if (!ownerPassword || !secretPhrase) {
                showStatus(statusEl, 'error', 'ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            localStorage.setItem('ownerPassword', ownerPassword);
            localStorage.setItem('secretPhrase', secretPhrase);

            showStatus(statusEl, 'success', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨åˆè¨€è‘‰ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼');

            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('ownerPassword').value = '';
            document.getElementById('secretPhrase').value = '';
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
        function resetAllData() {
            if (!confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                return;
            }

            const statusEl = document.getElementById('resetStatus');

            try {
                localStorage.removeItem('stylistsData');
                localStorage.removeItem('reviewsData');
                localStorage.removeItem('imagesData');
                localStorage.removeItem('ownerPassword');
                localStorage.removeItem('secretPhrase');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                localStorage.removeItem('ownerAuthenticated');

                showStatus(statusEl, 'success', 'ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚');
                updateDataStatus();
            } catch (error) {
                showStatus(statusEl, 'error', 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showStatus(element, type, message) {
            element.textContent = message;
            element.className = 'status-message status-' + type;
            element.style.display = 'block';

            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
